# 指示：プロダクト設計書の統合生成

## 1. あなたの役割
あなたは、大規模プロジェクトの経験が豊富なソフトウェアアーキテクトです。これから提供する仕様書に基づき、**システムの全体設計から各コンポーネントの詳細設計までを、指定されたフォーマットで一度に生成してください。**

このタスクは非常に大規模なため、最高の品質を維持するために、以下のステップを順番に、かつ注意深く実行してください。

## 2. 入力情報
- **仕様書:**:./ref/product/designディレクトリ内

## 3. 共通設計原則＆ルール
プロセス全体を通して、以下の原則とルールを厳守してください。

- **アーキテクチャ:** **クリーンアーキテクチャ**または**ドメイン駆動設計（DDD）**を基本とします。
- **ダイアグラム:** **C4モデル**に準拠し、**Mermaid記法**で記述します。
- **設計判断の記録:** 重要な技術的選択は、その背景やトレードオフを含めて**ADR（Architecture Decision Record）**として記録します。
- **トークン効率:**
    - 説明は冗長にせず、**箇条書きや表を多用**してください。
    - 仕様書の引用はせず、**`仕様書 §3.1`のようにセクション番号で参照**してください。

## 4. 最終的な成果物（ディレクトリ構造）
以下のファイルおよびディレクトリ構造で、すべての成果物を生成してください。

```plaintext
./log/task/
        ├── 1_system_overview.md
        ├── 2_architecture_decision.md
        ├── 3_bounded_context_list.md
        └── contexts/
            ├── <Context名1>/
            │   ├── README.md
            │   ├── UseCases.md
            │   ├── DomainModel.md
            │   ├── Interfaces.md
            │   └── Diagram.md
            └── <Context名2>/
                ├── (上記と同様のファイル群)
                └── ...
```

## 5. 実行ステップ

以下のステップを順番に実行し、上記のファイル構造に従って成果物を生成してください。

### 【ステップ1】全体設計

まず、システム全体の骨子を設計します。

#### 1.1. システム全体概要の生成

* **ファイル名:** `1_system_overview.md`
* **内容:**
   * プロダクトの目的を1〜2文で要約。
   * C4モデルの **Level 1: Context図** をMermaid記法で記述。

#### 1.2. アーキテクチャ設計とADRの生成

* **ファイル名:** `2_architecture_decision.md`
* **内容:**
   * プロジェクトに最適なアーキテクチャを選定し、その選定理由、他の選択肢との比較、メリット・デメリットを**ADR形式**で記述。

#### 1.3. Bounded Contextの定義

* **ファイル名:** `3_bounded_context_list.md`
* **内容:**
   * 仕様書を分析し、プロダクトを構成する主要な**Bounded Context**（境界づけられたコンテキスト）をすべて洗い出し、以下の表形式で記述。
   * **このリストは、続くステップ2で全てのContextを処理するために不可欠です。**

| Context名 | 責務（一言で） | 主要な関心事（エンティティやユースケース） |
|:---|:---|:---|
| `例: 注文管理コンテキスト` | `商品の注文受付から配送手配までを管理` | `注文, 注文商品, 配送先` |
| ... | ... | ... |

### 【ステップ2】各Bounded Contextの詳細設計（反復実行）

次に、**ステップ1.3で定義した全てのBounded Contextに対して、以下のファイル群を生成するプロセスを繰り返してください。** 生成されたファイルは、`./ref/product/plan/contexts/<Context名>/` のディレクトリに配置してください。

**For each Context:**

#### 📄 `README.md`

* このコンテキストの目的、境界、担当する主要なユースケースのリストを記述。

#### 📄 `UseCases.md`

* 主要なユースケースについて、以下の表形式で詳細を記述。

| UC-ID | ユースケース名 | 概要 | トリガー | 基本フロー |
|:---|:---|:---|:---|:---|
| `UC-001` | `商品を注文する` | ... | ... | `1. ... 2. ...` |

#### 📄 `DomainModel.md`

* このコンテキスト内の主要な**エンティティ、値オブジェクト、集約（Aggregate）**を定義。

#### 📄 `Interfaces.md`

* このコンテキストが外部とやり取りするための**インターフェース（APIエンドポイント、公開/購読するイベントなど）**を定義。

#### 📄 `Diagram.md`

* このコンテキストの構造を示す、C4モデルの **Level 2: Container図** または **Level 3: Component図** をMermaid記法で記述。

---

**指示は以上です。全てのステップを順番に実行し、指定された構造で全成果物を生成してください。**