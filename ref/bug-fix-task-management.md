# 不具合修正タスク管理

## 概要
本ドキュメントは、theMinutesBoardの5つの不具合修正のタスク管理を行うためのものです。

## タスク一覧

### 1. MTG退出時の議事録自動終了機能の実装
- [x] 現状の動作確認
- [x] 退出イベントの検知処理調査
- [x] 自動終了機能の実装
  - beforeunloadイベントでhandleCallEndedを呼ぶように修正
  - URLチェック間隔を2秒から0.5秒に短縮
- [x] テスト

### 2. 字幕OFF時の記録開始防止とポップアップ通知
- [x] 字幕ON/OFF状態の取得方法調査
- [x] 記録開始前のチェック処理実装
  - CHECK_CAPTIONSメッセージハンドラーを追加
- [x] ポップアップ通知の実装（エラーログなし）
  - alert()の代わりにUI内でエラー表示
  - 3秒後に自動消去
- [x] テスト

### 3. リサーチタブのマイク機能改善
- [x] 現在の実装調査
- [x] マイクボタン押下時の字幕保存処理実装
  - 既にstartTranscriptSnapshotが実装済み
- [x] 字幕差分計算ロジックの実装
  - AI_ASSISTANT_STOP時に差分のみを返すよう修正
- [x] 議題要約のコンテクスト送信機能実装
  - 既に実装済み（handleAiResearch内でcurrentTopicSummaryを送信）
- [x] テスト

### 4. ネクストステップの日付表示問題
- [x] 現在の日付表示ロジック調査
  - parseNextStepsResponseで優先度に基づくデフォルト期限設定済み
- [x] AIプロンプトの調整（日付フォーマット指定）
  - dueDateを必ずYYYY-MM-DD形式で出力するよう強調
- [x] プレースホルダーの実装
  - getDefaultDueDateで既に実装済み
- [x] テスト

### 5. ネクストステップの更新/消失問題
- [x] 更新処理のフロー調査
- [x] 問題の原因特定
  - handleGenerateNextStepsで既存ステップを完全に上書きしていた
- [x] 修正実装
  - 既存ステップと新規ステップをマージするロジックを実装
  - 完了済みステップやユーザー編集内容を保持
- [x] テスト

## 進捗記録
- 2025-07-06: タスク管理ファイル作成開始
- 2025-07-06: MTG退出時の議事録自動終了機能を実装
  - beforeunloadイベントでもhandleCallEndedを呼ぶように修正
  - URL監視の間隔を0.5秒に短縮して退出検知を高速化
- 2025-07-06: 字幕OFF時の記録開始防止機能を実装
  - CHECK_CAPTIONSメッセージハンドラーをcontent scriptに追加
  - popupのalert()をUI表示に変更（コンソールエラーを回避）
  - background scriptのレスポンス型を明示的に定義
- 2025-07-06: リサーチタブのマイク機能を修正
  - AI_ASSISTANT_STOP時にリサーチモードの場合は録音中の字幕のみを返すよう修正
  - 議題要約のコンテキスト送信は既に実装済みだった
- 2025-07-06: ネクストステップの日付表示問題を修正
  - AIプロンプトでdueDateを必ずYYYY-MM-DD形式で出力するよう強調
  - parseNextStepsResponseでのデフォルト期限設定は既に実装済み
- 2025-07-06: ネクストステップの更新/消失問題を修正
  - handleGenerateNextStepsで既存ステップと新規ステップをマージ
  - タスク内容と担当者をキーとしてマッチング
  - 完了済みステップを保持、ユーザー編集内容を優先