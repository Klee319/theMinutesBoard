# 状態同期機能テスト手順

## 実装した機能
Chrome拡張機能のポップアップ、ビューアタブ、コンテンツスクリプト間で以下の状態を同期：
- 録音状態（開始/停止）
- 議事録生成状態（生成中/完了/失敗）
- ボタンの有効/無効状態

## テスト手順

### 1. 準備
1. Chrome拡張機能を再読み込み
2. Google Meetの会議に参加
3. 字幕をONにする

### 2. 録音状態の同期テスト
1. **ポップアップから録音開始**
   - ポップアップを開く
   - Meet画面のコントロールパネルで「記録開始」ボタンの状態を確認
   - ビューアタブを開いて録音状態を確認

2. **コンテンツスクリプトから録音開始**
   - Meet画面のコントロールパネルで「記録開始」をクリック
   - ポップアップを開いて状態を確認
   - ビューアタブの状態を確認

3. **録音停止の同期**
   - いずれかのインターフェースから録音を停止
   - 全てのインターフェースで停止状態になることを確認

### 3. 議事録生成状態の同期テスト
1. **議事録生成開始**
   - 録音中に議事録生成ボタンをクリック
   - 全てのインターフェースでローディング状態になることを確認
   - ボタンが無効化されることを確認

2. **議事録生成完了**
   - 生成が完了したら全てのインターフェースで：
     - ローディング状態が解除される
     - ボタンのテキストが「議事録を更新」に変わる
     - ボタンが再度有効になる

3. **エラー時の同期**
   - APIキーを無効にして議事録生成を試す
   - 全てのインターフェースでエラー状態が同期されることを確認

### 4. タブ間の同期テスト
1. **複数のビューアタブ**
   - ビューアタブを複数開く
   - 一つのタブで操作して、他のタブに反映されることを確認

2. **タブの再読み込み**
   - 録音中にビューアタブを再読み込み
   - 状態が正しく復元されることを確認

### 5. 異常系テスト
1. **通話終了時**
   - 録音中に通話を終了
   - 全てのインターフェースで録音停止状態になることを確認

2. **拡張機能の再読み込み**
   - 録音中に拡張機能を再読み込み
   - 状態が正しく初期化されることを確認

## 確認ポイント
- [ ] ボタンの状態（有効/無効）が同期される
- [ ] ボタンのテキスト（記録開始/記録停止、議事録生成/議事録を更新）が同期される
- [ ] ローディング状態が全インターフェースで表示される
- [ ] エラーメッセージが適切に表示される
- [ ] 状態の更新が即座に反映される（遅延なし）

## 実装の詳細
- バックグラウンドスクリプトで中央状態管理（SharedState）
- Chrome Messaging APIを使用した双方向通信
- 新しいメッセージタイプ：
  - STATE_SYNC: 状態同期
  - REQUEST_STATE_SYNC: 状態同期リクエスト
  - MINUTES_GENERATION_STARTED: 議事録生成開始
  - MINUTES_GENERATION_COMPLETED: 議事録生成完了
  - MINUTES_GENERATION_FAILED: 議事録生成失敗